syntax = "proto3";

package todo.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/pivaldi/mmw/contracts/gen/go/todo/v1;todov1";

// TodoService provides CRUD operations for managing todos
service TodoService {
  rpc CreateTodo(CreateTodoRequest) returns (CreateTodoResponse);
  rpc GetTodo(GetTodoRequest) returns (GetTodoResponse);
  rpc UpdateTodo(UpdateTodoRequest) returns (UpdateTodoResponse);
  rpc CompleteTodo(CompleteTodoRequest) returns (CompleteTodoResponse);
  rpc ReopenTodo(ReopenTodoRequest) returns (ReopenTodoResponse);
  rpc DeleteTodo(DeleteTodoRequest) returns (DeleteTodoResponse);
  rpc ListTodos(ListTodosRequest) returns (ListTodosResponse);
}

// Todo represents a todo item with all its properties
message Todo {
  string id = 1;
  string title = 2;
  string description = 3;
  TaskStatus status = 4;
  Priority priority = 5;
  google.protobuf.Timestamp due_date = 6; // optional
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

// TaskStatus represents the current state of a todo
enum TaskStatus {
  TASK_STATUS_UNSPECIFIED = 0;
  TASK_STATUS_PENDING = 1;
  TASK_STATUS_IN_PROGRESS = 2;
  TASK_STATUS_COMPLETED = 3;
  TASK_STATUS_CANCELLED = 4;
}

// Priority indicates the importance/urgency of a todo
enum Priority {
  PRIORITY_UNSPECIFIED = 0;
  PRIORITY_LOW = 1;
  PRIORITY_MEDIUM = 2;
  PRIORITY_HIGH = 3;
  PRIORITY_URGENT = 4;
}

// CreateTodoRequest contains the data needed to create a new todo
message CreateTodoRequest {
  string title = 1;
  string description = 2;
  Priority priority = 3;
  google.protobuf.Timestamp due_date = 4; // optional
}

// CreateTodoResponse returns the newly created todo
message CreateTodoResponse {
  Todo todo = 1;
}

// GetTodoRequest specifies which todo to retrieve
message GetTodoRequest {
  string id = 1;
}

// GetTodoResponse returns the requested todo
message GetTodoResponse {
  Todo todo = 1;
}

// UpdateTodoRequest contains the fields to update on a todo
message UpdateTodoRequest {
  string id = 1;
  optional string title = 2;
  optional string description = 3;
  optional Priority priority = 4;
  optional google.protobuf.Timestamp due_date = 5;
  optional TaskStatus status = 6;
}

// UpdateTodoResponse returns the updated todo
message UpdateTodoResponse {
  Todo todo = 1;
}

// CompleteTodoRequest marks a todo as completed
message CompleteTodoRequest {
  string id = 1;
}

// CompleteTodoResponse returns the completed todo
message CompleteTodoResponse {
  Todo todo = 1;
}

// ReopenTodoRequest changes a completed todo back to pending
message ReopenTodoRequest {
  string id = 1;
}

// ReopenTodoResponse returns the reopened todo
message ReopenTodoResponse {
  Todo todo = 1;
}

// DeleteTodoRequest specifies which todo to delete
message DeleteTodoRequest {
  string id = 1;
}

// DeleteTodoResponse confirms deletion (empty response)
message DeleteTodoResponse {}

// ListTodosRequest contains optional filters for querying todos
message ListTodosRequest {
  optional TaskStatus status = 1; // filter by status
  optional Priority priority = 2; // filter by priority
  optional int32 limit = 3; // max results to return
  optional int32 offset = 4; // pagination offset
}

// ListTodosResponse returns a list of todos matching the filters
message ListTodosResponse {
  repeated Todo todos = 1;
  int32 total_count = 2; // total matching todos (for pagination)
}
